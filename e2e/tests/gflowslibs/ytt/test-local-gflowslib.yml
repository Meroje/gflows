setup:
  files:
    - path: my-lib/my-lib.gflowslib
      source: e2e/gflowslibs/ytt/my-lib.gflowslib
    - path: my-lib/libs/common/steps.lib.yml
      source: e2e/gflowslibs/ytt/libs/common/steps.lib.yml
    - path: my-lib/libs/common/values.yml
      source: e2e/gflowslibs/ytt/libs/common/values.yml
    - path: my-lib/libs/common/workflows.lib.yml
      source: e2e/gflowslibs/ytt/libs/common/workflows.lib.yml
    - path: .gflows/config.yml
      content: |
        templates:
          engine: ytt
          defaults:
            libs:
              - ../my-lib/my-lib.gflowslib
    - path: .gflows/workflows/test/config.yml
      content: |
        #@ load("common/steps.lib.yml", "run")
        "on":
          push:
            branches: [develop]
        jobs:
          hello:
            runs-on: ubuntu-latest
            steps:
            - #@ run('echo hello, world!')

run: update

expect:
  output: |2
         create .github/workflows/test.yml (from .gflows/workflows/test)
  files:
  - path: .gflows/config.yml
  - path: .gflows/workflows/test/config.yml
  - path: my-lib/my-lib.gflowslib
  - path: my-lib/libs/common/values.yml
  - path: my-lib/libs/common/steps.lib.yml
  - path: my-lib/libs/common/workflows.lib.yml
  - path: .github/workflows/test.yml
    content: |
      # File generated by gflows, do not modify
      # Source: .gflows/workflows/test
      "on":
        push:
          branches:
          - develop
      jobs:
        hello:
          runs-on: ubuntu-latest
          steps:
          - run: echo hello, world!
