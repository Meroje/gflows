setup:
  files:
    - path: https://example.com/my-lib.gflowslib
      content: |
        {
          "files": [
            "libs/common/steps.lib.yml",
            "workflows/test/config.yml"
          ]
        }
    - path: https://example.com/libs/common/steps.lib.yml
      content: |
        #@ def run(action):
          run: #@ action
        #@ end
    - path: https://example.com/workflows/test/config.yml
      content: |
        #@ load("common/steps.lib.yml", "run")
        "on":
          push:
            branches: [develop]
        jobs:
          hello:
            runs-on: ubuntu-latest
            steps:
            - #@ run('echo hello, world!')
    - path: .gflows/config.yml
      content: |
        templates:
          engine: ytt
          defaults:
            libs:
              - https://example.com/my-lib.gflowslib

run: update

expect:
  output: |2
         create .github/workflows/test.yml (from my-lib.gflowslib/workflows/test)
  files:
  - path: .gflows/config.yml
  - path: .github/workflows/test.yml
    content: |
      # File generated by gflows, do not modify
      # Source: my-lib.gflowslib/workflows/test
      "on":
        push:
          branches:
          - develop
      jobs:
        hello:
          runs-on: ubuntu-latest
          steps:
          - run: echo hello, world!
