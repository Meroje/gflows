package workflow

import (
	"fmt"
	"strings"

	"github.com/jbrunton/gflows/io/pkg"

	"github.com/jbrunton/gflows/yamlutil"
)

// Definition - definitoin for a workflow defined by a GFlows template
type Definition struct {
	Name        string
	Source      string
	Description string
	Destination string
	Content     string
	JSON        interface{}
	Status      ValidationResult
}

func (definition *Definition) SetContent(workflow string, template *pkg.PathInfo) {
	meta := strings.Join([]string{
		"# File generated by gflows, do not modify",
		fmt.Sprintf("# Source: %s", template.Description),
	}, "\n")
	definition.Content = meta + "\n" + workflow
	definition.Description = template.Description

	json, err := yamlutil.YamlToJson(definition.Content)
	if err != nil {
		definition.Status = ValidationResult{
			Valid:  false,
			Errors: []string{err.Error()},
		}
	} else {
		definition.JSON = json
	}
}
